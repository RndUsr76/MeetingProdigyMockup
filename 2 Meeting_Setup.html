<!DOCTYPE html>
<html lang="sv">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Meeting Setup | Meeting Prodigy</title>
    <link rel="stylesheet" href="css/main.css" />
    <link rel="stylesheet" href="css/meeting-setup.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
  </head>
  <body>
    <nav class="navbar">
      <div class="container">
        <div class="logo">Meeting Prodigy</div>
        <ul class="nav-links">
          <li><a href="index.html">Home</a></li>
          <li><a href="#help">Help</a></li>
        </ul>
      </div>
    </nav>

    <header class="setup-header">
      <div class="container">
        <h1>Meeting Setup</h1>
        <p class="subtitle">
          Define purpose, goals, participants and context – fast and structured.
        </p>
      </div>
    </header>

    <section class="voice-input-section">
      <div class="container">
        <div class="voice-toggle">
          <div class="toggle-options">
            <button class="toggle-option active" data-input-type="manual">
              <i class="fas fa-keyboard"></i> Manuell inmatning
            </button>
            <button
              class="toggle-option"
              data-input-type="voice"
              onclick="openVoiceRecording()"
            >
              <i class="fas fa-microphone"></i> Rösttranskribering
            </button>
          </div>
          <div class="voice-instructions">
            <p>
              <i class="fas fa-info-circle"></i> Klicka på "Rösttranskribering"
              och tala fritt om mötet. Vår AI strukturerar automatiskt
              informationen.
            </p>
          </div>
        </div>
      </div>
    </section>

    <main class="setup-container">
      <div class="container">
        <form class="meeting-form">
          <section class="form-section">
            <div class="section-header">
              <div class="step-number">1</div>
              <h2>General Information</h2>
            </div>
            <div class="form-group">
              <label for="meeting-title">Meeting Title</label>
              <input type="text" id="meeting-title" />
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="meeting-date">Date & Time</label>
                <input type="datetime-local" id="meeting-date" />
              </div>
              <div class="form-group">
                <label for="meeting-location">Location</label>
                <input type="text" id="meeting-location" />
              </div>
            </div>
          </section>

          <section class="form-section">
            <div class="section-header">
              <div class="step-number">2</div>
              <h2>Background & Purpose</h2>
            </div>
            <div class="form-group">
              <label for="meeting-purpose">Why is this meeting held?</label>
              <textarea id="meeting-purpose" rows="3"></textarea>
            </div>
            <div class="form-group">
              <label for="meeting-aim">What do we aim to achieve?</label>
              <textarea id="meeting-aim" rows="3"></textarea>
            </div>
            <div class="form-group">
              <label for="communication-style"
                >Preferred Communication Style</label
              >
              <select id="communication-style">
                <option value="">Välj</option>
                <option value="formal">Formal</option>
                <option value="informal">Informal</option>
                <option value="consultative">Consultative</option>
                <option value="persuasive">Persuasive</option>
              </select>
            </div>
          </section>

          <section class="form-section">
            <div class="section-header">
              <div class="step-number">3</div>
              <h2>Meeting Objectives</h2>
            </div>
            <div class="form-group">
              <label for="specific-goals">Specific Goals</label>
              <textarea id="specific-goals" rows="3"></textarea>
            </div>
            <div class="form-group">
              <label for="priorities">Priorities & Possible Compromises</label>
              <textarea id="priorities" rows="3"></textarea>
            </div>
          </section>

          <section class="form-section">
            <div class="section-header">
              <div class="step-number">4</div>
              <h2>Company Relationship & History</h2>
            </div>
            <div class="form-group">
              <label for="company-history">History with this company</label>
              <textarea id="company-history" rows="3"></textarea>
            </div>
            <div class="form-group">
              <label for="relationship-status"
                >Current relationship status</label
              >
              <textarea id="relationship-status" rows="3"></textarea>
            </div>
            <div class="form-group">
              <label for="company-perception">General perception of us</label>
              <textarea id="company-perception" rows="3"></textarea>
            </div>
          </section>

          <section class="form-section">
            <div class="section-header">
              <div class="step-number">5</div>
              <h2>Team Members</h2>
            </div>
            <div class="form-group">
              <div class="participant-table">
                <div class="table-header">
                  <div>Name</div>
                  <div>Title</div>
                  <div>Role</div>
                </div>
                <div class="table-row">
                  <div><input type="text" /></div>
                  <div><input type="text" /></div>
                  <div><input type="text" /></div>
                </div>
                <div class="table-row">
                  <div><input type="text" /></div>
                  <div><input type="text" /></div>
                  <div><input type="text" /></div>
                </div>
              </div>
            </div>
          </section>

          <section class="form-section">
            <div class="section-header">
              <div class="step-number">6</div>
              <h2>Counterpart Participants</h2>
            </div>
            <div class="form-group">
              <div class="participant-table">
                <div class="table-header">
                  <div>Name</div>
                  <div>Title</div>
                  <div>Role</div>
                </div>
                <div class="table-row">
                  <div><input type="text" /></div>
                  <div><input type="text" /></div>
                  <div><input type="text" /></div>
                </div>
                <div class="table-row">
                  <div><input type="text" /></div>
                  <div><input type="text" /></div>
                  <div><input type="text" /></div>
                </div>
              </div>
            </div>
          </section>

          <section class="form-section">
            <div class="section-header">
              <div class="step-number">7</div>
              <h2>Expected Questions</h2>
            </div>
            <div class="form-group">
              <div class="question-pair">
                <div class="form-group">
                  <label>Question</label>
                  <input type="text" />
                </div>
                <div class="form-group">
                  <label>Suggested Answer</label>
                  <textarea rows="2"></textarea>
                </div>
              </div>
              <div class="question-pair">
                <div class="form-group">
                  <label>Question</label>
                  <input type="text" />
                </div>
                <div class="form-group">
                  <label>Suggested Answer</label>
                  <textarea rows="2"></textarea>
                </div>
              </div>
            </div>
          </section>

          <section class="form-section">
            <div class="section-header">
              <div class="step-number">8</div>
              <h2>Additional Factors</h2>
            </div>
            <div class="form-group">
              <label for="competitors">Competitors</label>
              <textarea id="competitors" rows="2"></textarea>
            </div>
            <div class="form-group">
              <label for="internal-events">Internal Events</label>
              <textarea id="internal-events" rows="2"></textarea>
            </div>
            <div class="form-group">
              <label for="external-events">External Events</label>
              <textarea id="external-events" rows="2"></textarea>
            </div>
            <div class="form-group">
              <label for="known-risks">Known Risks</label>
              <textarea id="known-risks" rows="2"></textarea>
            </div>
          </section>
        </form>
      </div>
    </main>

    <script>
      let popupWindow;

      function openVoiceRecording() {
        popupWindow = window.open(
          "2.1 Simulated_Recording.html",
          "voiceRecordingWindow",
          "width=900,height=800"
        );
        const poll = setInterval(() => {
          if (popupWindow && popupWindow.closed) {
            clearInterval(poll);
            const stored = localStorage.getItem("simulatedMeetingData");
            const timestamp = localStorage.getItem("simulatedMeetingTimestamp");
            if (stored && timestamp) {
              const now = Date.now();
              const diff = now - Number(timestamp);
              if (diff < 10000) {
                const parsed = JSON.parse(stored);
                populateMeetingFields(parsed);
              }
              localStorage.removeItem("simulatedMeetingData");
              localStorage.removeItem("simulatedMeetingTimestamp");
            }
          }
        }, 500);
      }

      function populateMeetingFields(data) {
        if (!data) return;
        if (data.title)
          document.getElementById("meeting-title").value = data.title;
        if (data.date)
          document.getElementById("meeting-date").value = data.date;
        if (data.location)
          document.getElementById("meeting-location").value = data.location;
        if (data.purpose)
          document.getElementById("meeting-purpose").value = data.purpose;
        if (data.aim) document.getElementById("meeting-aim").value = data.aim;
        if (data.goals)
          document.getElementById("specific-goals").value = data.goals;
        if (data.priorities)
          document.getElementById("priorities").value = data.priorities;
        if (data.history)
          document.getElementById("company-history").value = data.history;
        if (data.relationship)
          document.getElementById("relationship-status").value =
            data.relationship;
        if (data.perception)
          document.getElementById("company-perception").value = data.perception;
        if (data.competitors)
          document.getElementById("competitors").value = data.competitors;
        if (data.internalEvents)
          document.getElementById("internal-events").value =
            data.internalEvents;
        if (data.externalEvents)
          document.getElementById("external-events").value =
            data.externalEvents;
        if (data.risks)
          document.getElementById("known-risks").value = data.risks;
        if (data.communicationStyle)
          document.getElementById("communication-style").value =
            data.communicationStyle;

        const ownRows = document.querySelectorAll(
          ".form-section:nth-of-type(5) .table-row"
        );
        data.ownTeam?.forEach((p, i) => {
          const inputs = ownRows[i]?.querySelectorAll("input");
          if (inputs) {
            if (p.name) inputs[0].value = p.name;
            if (p.title) inputs[1].value = p.title;
            if (p.role) inputs[2].value = p.role;
          }
        });

        const counterpartRows = document.querySelectorAll(
          ".form-section:nth-of-type(6) .table-row"
        );
        data.counterpartTeam?.forEach((p, i) => {
          const inputs = counterpartRows[i]?.querySelectorAll("input");
          if (inputs) {
            if (p.name) inputs[0].value = p.name;
            if (p.title) inputs[1].value = p.title;
            if (p.role) inputs[2].value = p.role;
          }
        });

        const qPairs = document.querySelectorAll(
          ".form-section:nth-of-type(7) .question-pair"
        );
        data.expectedQuestions?.forEach((q, i) => {
          const pair = qPairs[i]?.querySelectorAll("input, textarea");
          if (pair) {
            if (q.question) pair[0].value = q.question;
            if (q.answer) pair[1].value = q.answer;
          }
        });
      }
    </script>
  </body>
</html>
